"use strict";var version={v:"1.0.3"},hasOwn={}.hasOwnProperty,payment_elements={channel:null,credential:{},init:function(e){var a;if("string"==typeof e)try{a=JSON.parse(e)}catch(e){return void callbacks.innerCallback("fail",callbacks.error("json_decode_fail",e))}else a=e;if(void 0!==a){for(var n in this)hasOwn.call(a,n)&&(this[n]=a[n]);return this}callbacks.innerCallback("fail",callbacks.error("json_decode_fail"))},clear:function(){for(var e in this)"function"!=typeof this[e]&&(this[e]=null)}},callbacks={userCallback:void 0,innerCallback:function(e,a){"function"==typeof this.userCallback&&(void 0===a&&(a=this.error()),this.userCallback(e,a),this.userCallback=void 0,payment_elements.clear())},error:function(e,a){return{msg:e=void 0===e?"":e,extra:a=void 0===a?"":a}}},stash={},hasOwn$1={}.hasOwnProperty,wx_lite={handleCharge:function(e){for(var a=e.credential[e.channel],n=["appId","timeStamp","nonceStr","package","signType","paySign"],l=0;l<n.length;l++)if(!hasOwn$1.call(a,n[l]))return void callbacks.innerCallback("fail",callbacks.error("invalid_credential","missing_field_"+n[l]));stash.jsApiParameters=a,this.callpay()},wxLiteEnabled:function(){return"undefined"!=typeof wx&&wx.requestPayment},callpay:function(){if(this.wxLiteEnabled()){var e=stash.jsApiParameters;delete e.appId,e.complete=function(e){"requestPayment:ok"===e.errMsg&&callbacks.innerCallback("success"),"requestPayment:cancel"!==e.errMsg&&"requestPayment:fail cancel"!==e.errMsg||callbacks.innerCallback("cancel",callbacks.error("用户取消支付")),"undefined"!==e.err_code&&"undefined"!==e.err_desc&&callbacks.innerCallback("fail",callbacks.error(e.err_desc,e))},wx.requestPayment(e)}else console.log("请在微信小程序中打开")}},hasOwn$2={}.hasOwnProperty,wx_pub={handleCharge:function(e){for(var a=e.credential[e.channel],n=["appId","timeStamp","nonceStr","package","signType","paySign"],l=0;l<n.length;l++)if(!hasOwn$2.call(a,n[l]))return void callbacks.innerCallback("fail",callbacks.error("invalid_credential","missing_field_"+n[l]));stash.jsApiParameters=a,this.callpay()},callpay:function(){var e=this;if("undefined"==typeof WeixinJSBridge){var a=function(){e.jsApiCall()};document.addEventListener?document.addEventListener("WeixinJSBridgeReady",a,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",a),document.attachEvent("onWeixinJSBridgeReady",a))}else this.jsApiCall()},jsApiCall:function(){hasOwn$2.call(stash,"jsApiParameters")&&WeixinJSBridge.invoke("getBrandWCPayRequest",stash.jsApiParameters,function(e){delete stash.jsApiParameters,"get_brand_wcpay_request:ok"==e.err_msg?callbacks.innerCallback("success"):"get_brand_wcpay_request:cancel"==e.err_msg?callbacks.innerCallback("cancel"):callbacks.innerCallback("fail",callbacks.error("wx_result_fail",e.err_msg))})}},hasOwn$3={}.hasOwnProperty,mods={},mods_1=mods;mods.channels={wx_lite:wx_lite,wx_pub:wx_pub},mods.getChannelModule=function(e){if(hasOwn$3.call(mods.channels,e))return mods.channels[e]};var version$1=version.v,hasOwn$4={}.hasOwnProperty,WxPaySDK=function(){};WxPaySDK.prototype.version=version$1;var main=new WxPaySDK;WxPaySDK.prototype.createPayment=function(e,a){if("function"==typeof a&&(callbacks.userCallback=a),payment_elements.init(e),hasOwn$4.call(payment_elements,"channel")){var n=payment_elements.channel;if(hasOwn$4.call(payment_elements,"credential"))if(payment_elements.credential)if(hasOwn$4.call(payment_elements.credential,n)){var l=mods_1.getChannelModule(n);if(void 0===l)return console.error('channel module "'+n+'" is undefined'),void callbacks.innerCallback("fail",callbacks.error("invalid_channel",'channel module "'+n+'" is undefined'));l.handleCharge(payment_elements)}else callbacks.innerCallback("fail",callbacks.error("invalid_credential","credential_is_incorrect"));else callbacks.innerCallback("fail",callbacks.error("invalid_credential","credential_is_undefined"));else callbacks.innerCallback("fail",callbacks.error("invalid_charge","no_credential"))}else callbacks.innerCallback("fail",callbacks.error("invalid_charge","no_channel"))},module.exports=main;
